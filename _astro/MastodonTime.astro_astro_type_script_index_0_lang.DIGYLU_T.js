/**
 * Mastodon embed timeline
 * @author idotj
 * @version 4.4.2
 * @url https://gitlab.com/idotj/mastodon-embed-timeline
 * @license GNU AGPLv3
 */class x{constructor(t={}){this.defaultSettings={mtContainerId:"mt-container",instanceUrl:"https://mastodon.social",timelineType:"local",userId:"",profileName:"",hashtagName:"",spinnerClass:"mt-loading-spinner",defaultTheme:"auto",maxNbPostFetch:"20",maxNbPostShow:"20",dateLocale:"en-GB",dateOptions:{day:"2-digit",month:"short",year:"numeric"},hideUnlisted:!1,hideReblog:!1,hideReplies:!1,hidePinnedPosts:!1,hideUserAccount:!1,txtMaxLines:"",btnShowMore:"SHOW MORE",btnShowLess:"SHOW LESS",markdownBlockquote:!1,hideEmojos:!1,btnShowContent:"SHOW CONTENT",hideVideoPreview:!1,btnPlayVideoTxt:"Load and play video",hidePreviewLink:!1,previewMaxLines:"",hideCounterBar:!1,disableCarousel:!1,carouselCloseTxt:"Close carousel",carouselPrevTxt:"Previous media item",carouselNextTxt:"Next media item",btnSeeMore:"See more posts at Mastodon",btnReload:"Refresh",insistSearchContainer:!1,insistSearchContainerTime:"3000"},this.mtSettings={...this.defaultSettings,...t},this.#c(),this.linkHeader={},this.mtContainerNode="",this.mtBodyNode="",this.fetchedData={},this.#s(()=>{this.#p()})}#c(){Number(this.mtSettings.maxNbPostShow)>Number(this.mtSettings.maxNbPostFetch)&&(console.error(`Please check your settings! The maximum number of posts to show is bigger than the maximum number of posts to fetch. Changing the value of "maxNbPostFetch" to: ${this.mtSettings.maxNbPostShow}`),this.mtSettings.maxNbPostFetch=this.mtSettings.maxNbPostShow)}#s(t){typeof document<"u"&&document.readyState==="complete"?t():typeof document<"u"&&document.readyState!=="complete"&&document.addEventListener("DOMContentLoaded",t())}#p(){const t=()=>{this.mtContainerNode=document.getElementById(this.mtSettings.mtContainerId),this.mtBodyNode=this.mtContainerNode.getElementsByClassName("mt-body")[0],this.#g(),this.#l("newTimeline")};if(this.mtSettings.insistSearchContainer){const e=performance.now(),i=()=>{document.getElementById(this.mtSettings.mtContainerId)?t():performance.now()-e<this.mtSettings.insistSearchContainerTime?requestAnimationFrame(i):console.error(`Impossible to find the <div> container with id: "${this.mtSettings.mtContainerId}" after several attempts for ${this.mtSettings.insistSearchContainerTime/1e3} seconds`)};i()}else document.getElementById(this.mtSettings.mtContainerId)?t():console.error(`Impossible to find the <div> container with id: "${this.mtSettings.mtContainerId}". Please try to add the option 'insistSearchContainer: true' when initializing the script`)}mtUpdate(){this.#s(()=>{this.mtBodyNode.replaceChildren(),this.mtBodyNode.insertAdjacentHTML("afterbegin",'<div class="mt-loading-spinner"></div>'),this.#l("updateTimeline")})}mtColorTheme(t){this.#s(()=>{this.mtContainerNode.setAttribute("data-theme",t)})}#g(){if(this.mtSettings.defaultTheme==="auto"){let t=window.matchMedia("(prefers-color-scheme: dark)");t.matches?this.mtColorTheme("dark"):this.mtColorTheme("light"),t.addEventListener("change",e=>{e.matches?this.mtColorTheme("dark"):this.mtColorTheme("light")})}else this.mtColorTheme(this.mtSettings.defaultTheme)}#u(){return new Promise((t,e)=>{const i=this.mtSettings.instanceUrl?`${this.mtSettings.instanceUrl}/api/v1/`:this.#e("Please check your <strong>instanceUrl</strong> value","‚ö†Ô∏è"),a=this.#v(i),n=Object.entries(a).map(([s,o])=>{const r=s==="timeline";return this.#o(o,r).then(l=>({[s]:l})).catch(l=>(e(new Error(`Something went wrong fetching data from: ${o}`)),this.#e(l.message),{[s]:[]}))});Promise.all(n).then(async s=>{if(this.fetchedData=s.reduce((o,r)=>({...o,...r}),{}),!this.mtSettings.hidePinnedPosts&&this.fetchedData.pinned?.length!==void 0&&this.fetchedData.pinned.length!==0){const o=this.fetchedData.pinned.map(r=>({...r,pinned:!0}));this.fetchedData.timeline=[...o,...this.fetchedData.timeline]}if(this.#r())t();else{do await this.#b();while(!this.#r()&&this.linkHeader.next);t()}})})}#v(t){let e={};return this.mtSettings.timelineType==="profile"?this.mtSettings.userId?(e.timeline=`${t}accounts/${this.mtSettings.userId}/statuses?limit=${this.mtSettings.maxNbPostFetch}`,this.mtSettings.hidePinnedPosts||(e.pinned=`${t}accounts/${this.mtSettings.userId}/statuses?pinned=true`)):this.#e("Please check your <strong>userId</strong> value","‚ö†Ô∏è"):this.mtSettings.timelineType==="hashtag"?this.mtSettings.hashtagName?e.timeline=`${t}timelines/tag/${this.mtSettings.hashtagName}?limit=${this.mtSettings.maxNbPostFetch}`:this.#e("Please check your <strong>hashtagName</strong> value","‚ö†Ô∏è"):this.mtSettings.timelineType==="local"?e.timeline=`${t}timelines/public?local=true&limit=${this.mtSettings.maxNbPostFetch}`:this.#e("Please check your <strong>timelineType</strong> value","‚ö†Ô∏è"),this.mtSettings.hideEmojos||(e.emojos=`${t}custom_emojis`),e}async#o(t,e=!1){const i=await fetch(t);if(!i.ok)throw new Error(`
        Failed to fetch the following Url:<br />${t}<hr />Error status: ${i.status}<hr />Error message: ${i.statusText}
        `);const a=await i.json();return e&&i.headers.get("Link")&&(this.linkHeader=this.#w(i.headers.get("Link"))),a}#r(){return this.fetchedData.timeline.length>=Number(this.mtSettings.maxNbPostFetch)}#b(){return new Promise(t=>{this.linkHeader.next?this.#o(this.linkHeader.next,!0).then(e=>{this.fetchedData.timeline=[...this.fetchedData.timeline,...e],t()}):t()})}#w(t){const e=t.split(", ").map(i=>i.split("; ")).map(i=>[i[1].replace(/"/g,"").replace("rel=",""),i[0].slice(1,-1)]);return Object.fromEntries(e)}async#l(t){await this.#u();const e=this.fetchedData.timeline;let i=0;if(this.mtBodyNode.replaceChildren(),e.forEach(a=>{const n=a.visibility==="public"||!this.mtSettings.hideUnlisted&&a.visibility==="unlisted",s=this.mtSettings.hideReblog&&a.reblog,o=this.mtSettings.hideReplies&&a.in_reply_to_id;!n||s||o||i<this.mtSettings.maxNbPostShow&&(this.#x(a,i),i++)}),this.mtBodyNode.innerHTML!=="")t==="newTimeline"?(this.#h(),this.#f(),this.#S(i),this.#q(),(this.mtSettings.btnSeeMore||this.mtSettings.btnReload)&&this.#B()):t==="updateTimeline"?this.#h():this.#e("The function buildTimeline() was expecting a param");else{const a=`No posts to show<hr />${e?.length||0} posts have been fetched from the server<hr />This may be due to an incorrect configuration with the parameters or with the filters applied (to hide certains type of posts)`;this.#e(a,"üì≠")}}#f(){this.mtSettings.txtMaxLines!=="0"&&this.mtSettings.txtMaxLines.length!==0&&this.mtBodyNode.parentNode.style.setProperty("--mt-txt-max-lines",this.mtSettings.txtMaxLines),this.mtSettings.previewMaxLines!=="0"&&this.mtSettings.previewMaxLines.length!==0&&this.mtBodyNode.parentNode.style.setProperty("--mt-preview-max-lines",this.mtSettings.previewMaxLines)}#S(t){const e=this.mtBodyNode.getElementsByTagName("article");for(let i=0;i<t;i++)e[i].setAttribute("aria-setsize",t)}#x(t,e){this.mtBodyNode.insertAdjacentHTML("beforeend",this.#y(t,e))}#y(t,e){let i,a,n,s,o,r,l,p,c,g;t.reblog?(o=t.reblog.url,i='<a href="'+t.reblog.account.url+'" class="mt-post-avatar" rel="nofollow noopener noreferrer" target="_blank"><div class="mt-post-avatar-boosted"><div class="mt-post-avatar-image-big mt-loading-spinner"><img src="'+t.reblog.account.avatar+'" alt="'+this.#t(t.reblog.account.username)+' avatar" loading="lazy" /></div><div class="mt-post-avatar-image-small"><img src="'+t.account.avatar+'" alt="'+this.#t(t.account.username)+' avatar" loading="lazy" /></div></div></a>',n=!this.mtSettings.hideEmojos&&t.reblog.account.display_name?this.#a(t.reblog.account.display_name,t.reblog.account.emojis):t.reblog.account.display_name?t.reblog.account.display_name:t.reblog.account.username,s=this.mtSettings.hideUserAccount?"":'<br /><span class="mt-post-header-user-account">@'+t.reblog.account.username+"@"+new URL(t.reblog.account.url).hostname+"</span>",a='<div class="mt-post-header-user"><a href="'+t.reblog.account.url+'" rel="nofollow noopener noreferrer" target="_blank"><bdi class="mt-post-header-user-name">'+n+"</bdi>"+s+"</a></div>",r=t.reblog.created_at,g=t.reblog.replies_count,c=t.reblog.reblogs_count,p=t.reblog.favourites_count):(o=t.url,i='<a href="'+t.account.url+'" class="mt-post-avatar" rel="nofollow noopener noreferrer" target="_blank"><div class="mt-post-avatar-standard"><div class="mt-post-avatar-image-big mt-loading-spinner"><img src="'+t.account.avatar+'" alt="'+this.#t(t.account.username)+' avatar" loading="lazy" /></div></div></a>',n=!this.mtSettings.hideEmojos&&t.account.display_name?this.#a(t.account.display_name,t.account.emojis):t.account.display_name?t.account.display_name:t.account.username,s=this.mtSettings.hideUserAccount?"":'<br /><span class="mt-post-header-user-account">@'+t.account.username+"@"+new URL(t.account.url).hostname+"</span>",a='<div class="mt-post-header-user"><a href="'+t.account.url+'" rel="nofollow noopener noreferrer" target="_blank"><bdi class="mt-post-header-user-name">'+n+"</bdi>"+s+"</a></div>",r=t.created_at,g=t.replies_count,c=t.reblogs_count,p=t.favourites_count),l=this.#k(r);const b=`
      <div class="mt-post-header-date">
        ${t.pinned?'<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" class="mt-post-pinned" aria-hidden="true"><path d="m640-480 80 80v80H520v240l-40 40-40-40v-240H240v-80l80-80v-280h-40v-80h400v80h-40v280Zm-286 80h252l-46-46v-314H400v314l-46 46Zm126 0Z"></path></svg>':""}
        <a href="${o}" rel="nofollow noopener noreferrer" target="_blank">
          <time datetime="${r}">
            ${l}
          </time>
          ${t.edited_at?" *":""}
        </a>
      </div>`;let v="";if(this.mtSettings.txtMaxLines!=="0"){const m=this.mtSettings.txtMaxLines.length!==0?" truncate":"";v=t.spoiler_text!==""?'<div class="mt-post-txt">'+this.#i(t.spoiler_text)+' <button type="button" class="mt-btn-dark mt-btn-spoiler-txt" aria-expanded="false">'+this.mtSettings.btnShowMore+'</button><div class="spoiler-txt-hidden">'+this.#i(t.content)+"</div></div>":t.reblog&&t.reblog.content!==""&&t.reblog.spoiler_text!==""?'<div class="mt-post-txt">'+this.#i(t.reblog.spoiler_text)+' <button type="button" class="mt-btn-dark mt-btn-spoiler-txt" aria-expanded="false">'+this.mtSettings.btnShowMore+'</button><div class="spoiler-txt-hidden">'+this.#i(t.reblog.content)+"</div></div>":t.reblog&&t.reblog.content!==""&&t.reblog.spoiler_text===""?'<div class="mt-post-txt'+m+'"><div class="mt-post-txt-wrapper">'+this.#i(t.reblog.content)+"</div></div>":'<div class="mt-post-txt'+m+'"><div class="mt-post-txt-wrapper">'+this.#i(t.content)+"</div></div>"}let d=[];if(t.media_attachments.length>0)for(let m in t.media_attachments)d.push(this.#d(t.media_attachments[m],t.sensitive));if(t.reblog&&t.reblog.media_attachments.length>0)for(let m in t.reblog.media_attachments)d.push(this.#d(t.reblog.media_attachments[m],t.reblog.sensitive));d=`<div class="mt-post-media-wrapper">${d.join("")}</div>`;let h="";!this.mtSettings.hidePreviewLink&&t.card&&(h=this.#A(t.card));let w="";if(t.poll){let m="";for(let S in t.poll.options)m+="<li>"+t.poll.options[S].title+"</li>";w='<div class="mt-post-poll '+(t.poll.expired?"mt-post-poll-expired":"")+'"><ul>'+m+"</ul></div>"}let f="";return this.mtSettings.hideCounterBar||(f='<div class="mt-post-counter-bar">'+('<div class="mt-post-counter-bar-replies"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 -960 960 960" aria-hidden="true"><path d="M774.913-185.869V-356q0-56.609-35.891-92.5-35.892-35.891-92.5-35.891H258.045L411.435-331l-56 56.566L105.869-524l249.566-249.566 56 56.566-153.39 153.391h388.477q88.957 0 148.566 59.609 59.608 59.609 59.608 148v170.131h-79.783Z"></path></svg>'+g+"</div>")+('<div class="mt-post-counter-bar-reblog"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 -960 960 960" aria-hidden="true"><path d="M276.043-65.304 105.869-236.043l170.174-170.175 52.74 54.175-78.652 78.652h449.304v-160h75.261v235.261H250.131l78.652 78.087-52.74 54.74Zm-90.174-457.348v-235.261h524.565L631.782-836l52.74-54.74L854.696-720 684.522-549.26 631.782-604l78.652-78.652H261.13v160h-75.261Z"></path></svg>'+c+"</div>")+('<div class="mt-post-counter-bar-favorites"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 -960 960 960" aria-hidden="true"><path d="m330.955-216.328 149.066-89 149.066 90.023-40.305-168.391 131.217-114.347-172.956-14.87L480-671.869l-67.043 158.521-172.956 14.305 131.427 113.796-40.473 168.919ZM212.086-50.608l70.652-305.305L45.52-561.305l312.645-26.579L480-876.176l121.835 288.292 312.645 26.579-237.218 205.392 71.217 305.306L480-213.173 212.086-50.607ZM480-433.87Z"></path></svg>'+p+"</div>")+"</div>"),'<article class="mt-post" aria-posinset="'+(e+1)+'" data-location="'+o+'" tabindex="0"><div class="mt-post-header">'+i+a+b+"</div>"+v+d+h+w+f+"</article>"}#N(t,e){function i(s,o){let r=o.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(s)||!r.includes("javascript:")&&!r.includes("data:"))||!!s.startsWith("on")||void 0}function a(s){let o=s.attributes;for(let{name:r,value:l}of o)i(r,l)&&s.removeAttribute(r)}let n=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body");return function(s){let o=s.querySelectorAll("script");for(let r of o)r.remove()}(n),function s(o){let r=o.children;for(let l of r)a(l),s(l)}(n),e?n.childNodes:n.innerHTML}#i(t){let e=t;return e=this.#N(e,!1),e=this.#L(e),this.mtSettings.hideEmojos||(e=this.#a(e,this.fetchedData.emojos)),this.mtSettings.markdownBlockquote&&(e=this.#T(e,"<p>&gt;","</p>","<blockquote><p>","</p></blockquote>")),e}#L(t){let e=t.replaceAll('rel="tag"','rel="tag" target="_blank"');return e=e.replaceAll('class="u-url mention"','class="u-url mention" target="_blank"'),e}#T(t,e,i,a,n){if(t.includes(e)){const s=new RegExp(e+"(.*?)"+i,"gi");return t.replace(s,a+"$1"+n)}return t}#t(t){return(t??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}#a(t,e){if(t.includes(":")){for(const i of e){const a=new RegExp(`\\:${i.shortcode}\\:`,"g");t=t.replace(a,`<img src="${i.url}" class="mt-custom-emoji" alt="Emoji ${i.shortcode}" />`)}return t}return t}#k(t){const e=new Date(t);return new Intl.DateTimeFormat(this.mtSettings.dateLocale,this.mtSettings.dateOptions).format(e)}#d(t,e=!1){const i=t.type,a=e;let n="";const s='<button class="mt-btn-dark mt-btn-spoiler-media mt-btn-spoiler-media-hide"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" class="icon icon-eye-slash" aria-hidden="true"><path d="m644-428-58-58q9-47-27-88t-93-32l-58-58q17-8 34.5-12t37.5-4q75 0 127.5 52.5T660-500q0 20-4 37.5T644-428Zm128 126-58-56q38-29 67.5-63.5T832-500q-50-101-143.5-160.5T480-720q-29 0-57 4t-55 12l-62-62q41-17 84-25.5t90-8.5q151 0 269 83.5T920-500q-23 59-60.5 109.5T772-302Zm20 246L624-222q-35 11-70.5 16.5T480-200q-151 0-269-83.5T40-500q21-53 53-98.5t73-81.5L56-792l56-56 736 736-56 56ZM222-624q-29 26-53 57t-41 67q50 101 143.5 160.5T480-280q20 0 39-2.5t39-5.5l-36-38q-11 3-21 4.5t-21 1.5q-75 0-127.5-52.5T300-500q0-11 1.5-21t4.5-21l-84-82Zm319 93Zm-151 75Z"></path></svg></button><button class="mt-btn-dark mt-btn-spoiler-media mt-btn-spoiler-media-show">'+this.mtSettings.btnShowContent+"</button>";return i==="image"&&(n='<div class="mt-post-media '+(a?"mt-post-media-spoiler ":"")+this.mtSettings.spinnerClass+'" data-media-type="'+i+'" data-media-url-hd="'+t.url+'" data-media-alt-txt="'+(t.description?this.#t(t.description):"")+'" data-media-width-hd="'+t.meta.original.width+'" data-media-height-hd="'+t.meta.original.height+'" style="padding-top: calc(100%/'+t.meta.small.aspect+')">'+(a?s:"")+'<img src="'+t.preview_url+'" alt="'+(t.description?this.#t(t.description):"")+'" loading="lazy" /></div>'),i==="audio"&&(n=t.preview_url?'<div class="mt-post-media '+(a?"mt-post-media-spoiler ":"")+this.mtSettings.spinnerClass+'" data-media-type="'+i+'" data-media-url-hd="'+t.preview_url+'" data-media-alt-txt="'+(t.description?this.#t(t.description):"")+'" data-media-width-hd="'+t.meta.small.width+'" data-media-height-hd="'+t.meta.small.height+'" style="padding-top: calc(100%/'+t.meta.small.aspect+')">'+(a?s:"")+'<audio controls src="'+t.url+'"></audio><img src="'+t.preview_url+'" alt="'+(t.description?this.#t(t.description):"")+'" loading="lazy" /></div>':'<div class="mt-post-media '+(a?"mt-post-media-spoiler ":"")+'" data-media-type="'+i+'">'+(a?s:"")+'<audio controls src="'+t.url+'"></audio></div>'),i!=="video"&&i!=="gifv"||(n=this.mtSettings.hideVideoPreview?'<div class="mt-post-media '+(a?"mt-post-media-spoiler ":"")+'" data-media-type="'+i+'" data-media-url-hd="'+t.url+'" data-media-alt-txt="'+(t.description?this.#t(t.description):"")+'" data-media-width-hd="'+t.meta.original.width+'" data-media-width-hd="'+t.meta.original.height+'" style="padding-top: calc(100%/'+t.meta.small.aspect+')">'+(a?s:"")+'<video controls src="'+t.url+'" loop></video></div>':'<div class="mt-post-media '+(a?"mt-post-media-spoiler ":"")+this.mtSettings.spinnerClass+'" data-media-type="'+i+'" data-media-url-hd="'+t.url+'" data-media-alt-txt="'+(t.description?this.#t(t.description):"")+'" data-media-width-hd="'+t.meta.original.width+'" data-media-height-hd="'+t.meta.original.height+'" style="padding-top: calc(100%/'+t.meta.small.aspect+')">'+(a?s:"")+'<img src="'+t.preview_url+'" alt="'+(t.description?this.#t(t.description):"")+'" loading="lazy" /><button class="mt-btn-play" title="'+this.mtSettings.btnPlayVideoTxt+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 14"><path d="M9.5 7l-9 6.3V.7z"/></svg></button></div>'),n}#C(t,e){let i=document.createElement("dialog");i.id=t,i.classList.add("mt-dialog"),i.dataset.theme=this.mtContainerNode.getAttribute("data-theme"),i.innerHTML=e,document.body.prepend(i),i.showModal(),i.addEventListener("close",()=>{document.body.removeChild(i)})}#$(t){const e=Array.from(t.target.parentNode.parentNode.children).filter(s=>!s.classList.contains("mt-post-media-spoiler")),i=e.indexOf(t.target.parentNode)+1;let a=[];e.forEach((s,o)=>{let r="";r=s.getAttribute("data-media-type")==="gifv"||s.getAttribute("data-media-type")==="video"?`
        <video controls src="${s.getAttribute("data-media-url-hd")}" width="${s.getAttribute("data-media-width-hd")}" height="${s.getAttribute("data-media-height-hd")}" class="mt-carousel-media" style="max-width:${s.getAttribute("data-media-width-hd")}px; max-height:${s.getAttribute("data-media-height-hd")}px" loop>
        </video>
        `:`
        <img src="${s.getAttribute("data-media-url-hd")}" width="${s.getAttribute("data-media-width-hd")}" height="${s.getAttribute("data-media-height-hd")}" class="mt-carousel-media mt-loading-spinner" alt="${s.getAttribute("data-media-alt-txt")}" style="max-width:${s.getAttribute("data-media-width-hd")}px; max-height:${s.getAttribute("data-media-height-hd")}px" dragabble="false" />
        `;const l=`
      <li class="mt-carousel-item">
        <div id="mt-carousel-${o+1}" class="mt-carousel-media-wrapper" data-media-type="${s.getAttribute("data-media-type")}">
          ${r}
        </div>
      </li>
      `;a.push(l)});const n=`
    <div class="mt-carousel-header">
      <form method="dialog">
        <button id="mt-carousel-close" class="mt-btn-dark" title="${this.mtSettings.carouselCloseTxt}">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path fill-rule="evenodd" d="M5.293 5.293a1 1 0 0 1 1.414 0L12 10.586l5.293-5.293a1 1 0 0 1 1.414 1.414L13.414 12l5.293 5.293a1 1 0 0 1-1.414 1.414L12 13.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L10.586 12 5.293 6.707a1 1 0 0 1 0-1.414z" fill="var(--mt-color-content-txt)"/>
          </svg>
        </button>
      </form>
    </div>

    <div class="mt-carousel-body">
      <ul id="mt-carousel-scroll" class="mt-carousel-scroll">
        ${a.join("")}
      </ul>
    </div>

    <button id="mt-carousel-prev" class="mt-carousel-prev" title="${this.mtSettings.carouselPrevTxt}" ${i===1?"hidden":""}>
      <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" aria-hidden="true">
        <path d="M560-240 320-480l240-240 56 56-184 184 184 184-56 56Z" fill="var(--mt-color-content-txt)"></path>
      </svg>
    </button>

    <button id="mt-carousel-next" class="mt-carousel-next" title="${this.mtSettings.carouselNextTxt}" ${i===e.length?"hidden":""}>
      <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" aria-hidden="true">
        <path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z" fill="var(--mt-color-content-txt)"></path>
      </svg>
    </button>
  `;this.#C("mt-carousel",n),a.length>=2&&this.#E(e.length,i)}#E(t,e){let i=e;const a=document.getElementById("mt-carousel-scroll");let n=0,s=!1;const o=document.getElementById("mt-carousel-prev"),r=document.getElementById("mt-carousel-next"),l=(d,h="smooth")=>{document.getElementById("mt-carousel-"+d).scrollIntoView({behavior:h})};l(i,"instant");const p=()=>{clearTimeout(n),n=setTimeout(()=>{s&&(i=(()=>{const d=(a.scrollLeft+a.clientWidth)/a.clientWidth;return Math.round(d+Number.EPSILON)})(),c()),s=!0},60)};a.addEventListener("scroll",p);const c=()=>{o.hidden=i===1,r.hidden=i===t},g=d=>{const h=d.target.closest("button")?.id;h==="mt-carousel-next"?(s=!1,++i,i>t&&(i=t),l(i),c()):h==="mt-carousel-prev"&&(s=!1,--i,i<1&&(i=1),l(i),c()),h==="mt-carousel-close"&&v()};document.addEventListener("click",g);const b=d=>{d.key!=="Escape"&&d.keyCode!==27||v()};document.addEventListener("keydown",b);const v=()=>{a.removeEventListener("scroll",p),document.removeEventListener("click",g),document.removeEventListener("keydown",b)}}#_(t){const e=t.target.closest("[data-media-type]"),i=e.dataset.mediaUrlHd;e.replaceChildren(),e.innerHTML=`<video controls src="${i}" autoplay loop></video>`}#M(t){const e=t.target,i=e.nextSibling;e.textContent==this.mtSettings.btnShowMore?(i.classList.remove("spoiler-txt-hidden"),i.classList.add("spoiler-txt-visible"),e.setAttribute("aria-expanded","true"),e.textContent=this.mtSettings.btnShowLess):(i.classList.remove("spoiler-txt-visible"),i.classList.add("spoiler-txt-hidden"),e.setAttribute("aria-expanded","false"),e.textContent=this.mtSettings.btnShowMore)}#P(t){const e=t.target;e.classList.contains("mt-btn-spoiler-media-show")?e.parentNode.classList.remove("mt-post-media-spoiler"):e.parentNode.classList.add("mt-post-media-spoiler")}#A(t){let e="";return this.mtSettings.previewMaxLines!=="0"&&t.description&&(e='<span class="mt-post-preview-description'+(this.mtSettings.previewMaxLines.length!==0?" truncate":"")+'">'+this.#n(t.description)+"</span>"),'<a href="'+t.url+'" class="mt-post-preview" target="_blank" rel="noopener noreferrer">'+(t.image?'<div class="mt-post-preview-image '+this.mtSettings.spinnerClass+'"><img src="'+t.image+'" alt="'+this.#t(t.image_description)+'" loading="lazy" /></div>':'<div class="mt-post-preview-noImage">üìÑ</div>')+'</div><div class="mt-post-preview-content">'+(t.provider_name?'<span class="mt-post-preview-provider">'+this.#n(t.provider_name)+"</span>":"")+'<span class="mt-post-preview-title">'+t.title+"</span>"+e+(t.author_name?'<span class="mt-post-preview-author">'+this.#n(t.author_name)+"</span>":"")+"</div></a>"}#n(t){return new DOMParser().parseFromString(t,"text/html").body.textContent}#B(){let t="",e="";if(this.mtSettings.btnSeeMore){let i="";this.mtSettings.timelineType==="profile"?this.mtSettings.profileName?i=this.mtSettings.profileName:this.#e("Please check your <strong>profileName</strong> value","‚ö†Ô∏è"):this.mtSettings.timelineType==="hashtag"?i="tags/"+this.mtSettings.hashtagName:this.mtSettings.timelineType==="local"&&(i="public/local"),t=`
          <a class="mt-btn-violet btn-see-more" href="${this.mtSettings.instanceUrl}/${this.#t(i)}" rel="nofollow noopener noreferrer" target="_blank">
            ${this.mtSettings.btnSeeMore}
          </a>`}this.mtSettings.btnReload&&(e=`
          <button class="mt-btn-violet btn-refresh">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 3v5m0 0h-5m5 0l-3-2.708C16.408 3.867 14.305 3 12 3a9 9 0 1 0 0 18c4.283 0 7.868-2.992 8.777-7" stroke="var(--mt-color-btn-txt)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
              ${this.mtSettings.btnReload}
          </button>`),this.mtBodyNode.parentNode.insertAdjacentHTML("beforeend",'<div class="mt-footer">'+t+e+"</div>"),this.mtSettings.btnReload&&this.mtContainerNode.getElementsByClassName("btn-refresh")[0].addEventListener("click",()=>{this.mtUpdate()})}#q(){this.mtBodyNode.addEventListener("click",t=>{const e=t.target,i=e.localName,a=e.parentNode;(i=="article"||e.offsetParent?.localName=="article"||this.mtSettings.disableCarousel&&a.getAttribute("data-media-type")==="image")&&this.#m(t),e.classList.contains("mt-btn-spoiler-txt")&&this.#M(t),e.classList.contains("mt-btn-spoiler-media")&&this.#P(t),this.mtSettings.disableCarousel||i!="img"||a.getAttribute("data-media-type")!=="image"&&a.getAttribute("data-media-type")!=="audio"||this.#$(t),(e.className=="mt-btn-play"||i=="svg"&&a.className=="mt-btn-play"||i=="path"&&a.parentNode.className=="mt-btn-play"||i=="img"&&(a.getAttribute("data-media-type")==="video"||a.getAttribute("data-media-type")==="gifv"))&&this.#_(t)}),this.mtBodyNode.addEventListener("keydown",t=>{const e=t.target.localName;t.key==="Enter"&&e=="article"&&this.#m(t)})}#m(t){const e=t.target.closest(".mt-post").dataset.location;t.target.localName!=="a"&&t.target.localName!=="span"&&t.target.localName!=="button"&&t.target.localName!=="bdi"&&t.target.localName!=="time"&&!t.target.classList.contains("mt-post-media-spoiler")&&t.target.className!=="mt-post-preview-noImage"&&t.target.parentNode.className!=="mt-post-avatar-image-big"&&t.target.parentNode.className!=="mt-post-avatar-image-small"&&t.target.parentNode.className!=="mt-post-header-user-name"&&t.target.parentNode.className!=="mt-post-preview-image"&&t.target.parentNode.className!=="mt-post-preview"&&e&&window.open(e,"_blank","noopener")}#h(){const t=e=>{e.target.parentNode.classList.remove(this.mtSettings.spinnerClass),e.target.removeEventListener("load",t),e.target.removeEventListener("error",t)};this.mtBodyNode.querySelectorAll(`.${this.mtSettings.spinnerClass} > img`).forEach(e=>{e.addEventListener("load",t),e.addEventListener("error",t)})}#e(t,e){const i=e||"‚ùå";throw this.mtBodyNode.innerHTML=`
      <div class="mt-error">
        <span class="mt-error-icon">${i}</span>
        <strong>Oops, something's happened:</strong>
        <div class="mt-error-message">${t}</div>
      </div>`,this.mtBodyNode.setAttribute("role","none"),new Error("Stopping the script due to an error building the timeline.")}}document.addEventListener("astro:page-load",()=>{const u=document.getElementById("mt-container"),t=i=>{u&&new x({instanceUrl:"https://280562.com",timelineType:"profile",userId:"111445620201896920",profileName:"@laomai",defaultTheme:i,maxNbPostFetch:"10",maxNbPostShow:"10",hideUserAccount:!0,btnSeeMore:"",btnReload:""})},e=document.documentElement.classList.contains("dark")?"dark":"light";t(e)});const y=()=>{const u=document.getElementById("mt-container");if(u){const t=document.documentElement.classList.contains("dark")?"dark":"light";u.setAttribute("data-theme",t)}},N=new MutationObserver(()=>{y()});N.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]});
